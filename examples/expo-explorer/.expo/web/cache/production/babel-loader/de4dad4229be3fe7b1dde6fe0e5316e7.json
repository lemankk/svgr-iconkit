{"ast":null,"code":"import _toConsumableArray from\"@babel/runtime/helpers/toConsumableArray\";import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";import{VisuallyHidden}from\"@react-aria/visually-hidden\";import _reactDom from\"react-dom\";import _react,{Fragment,useImperativeHandle,useState}from\"react\";var $de8b453f082d29ae3c4c121e2b261$var$LIVEREGION_TIMEOUT_DELAY=7000;var $de8b453f082d29ae3c4c121e2b261$var$liveRegionAnnouncer=_react.createRef();var $de8b453f082d29ae3c4c121e2b261$var$node=null;var $de8b453f082d29ae3c4c121e2b261$var$messageId=0;export function announce(message,assertiveness,timeout){if(assertiveness===void 0){assertiveness='assertive';}if(timeout===void 0){timeout=$de8b453f082d29ae3c4c121e2b261$var$LIVEREGION_TIMEOUT_DELAY;}$de8b453f082d29ae3c4c121e2b261$var$ensureInstance(function(announcer){return announcer.announce(message,assertiveness,timeout);});}export function clearAnnouncer(assertiveness){$de8b453f082d29ae3c4c121e2b261$var$ensureInstance(function(announcer){return announcer.clear(assertiveness);});}export function destroyAnnouncer(){if($de8b453f082d29ae3c4c121e2b261$var$liveRegionAnnouncer.current){_reactDom.unmountComponentAtNode($de8b453f082d29ae3c4c121e2b261$var$node);document.body.removeChild($de8b453f082d29ae3c4c121e2b261$var$node);$de8b453f082d29ae3c4c121e2b261$var$node=null;}}function $de8b453f082d29ae3c4c121e2b261$var$ensureInstance(callback){if(!$de8b453f082d29ae3c4c121e2b261$var$liveRegionAnnouncer.current){$de8b453f082d29ae3c4c121e2b261$var$node=document.createElement('div');$de8b453f082d29ae3c4c121e2b261$var$node.dataset.liveAnnouncer='true';document.body.prepend($de8b453f082d29ae3c4c121e2b261$var$node);_reactDom.render(_react.createElement($de8b453f082d29ae3c4c121e2b261$var$LiveRegionAnnouncer,{ref:$de8b453f082d29ae3c4c121e2b261$var$liveRegionAnnouncer}),$de8b453f082d29ae3c4c121e2b261$var$node,function(){return callback($de8b453f082d29ae3c4c121e2b261$var$liveRegionAnnouncer.current);});}else{callback($de8b453f082d29ae3c4c121e2b261$var$liveRegionAnnouncer.current);}}var $de8b453f082d29ae3c4c121e2b261$var$LiveRegionAnnouncer=_react.forwardRef(function(_,ref){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),assertiveMessages=_useState2[0],setAssertiveMessages=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),politeMessages=_useState4[0],setPoliteMessages=_useState4[1];var clear=function clear(assertiveness){if(!assertiveness||assertiveness==='assertive'){setAssertiveMessages([]);}if(!assertiveness||assertiveness==='polite'){setPoliteMessages([]);}};var announce=function announce(message,assertiveness,timeout){if(assertiveness===void 0){assertiveness='assertive';}if(timeout===void 0){timeout=$de8b453f082d29ae3c4c121e2b261$var$LIVEREGION_TIMEOUT_DELAY;}var id=$de8b453f082d29ae3c4c121e2b261$var$messageId++;if(assertiveness==='assertive'){setAssertiveMessages(function(messages){return[].concat(_toConsumableArray(messages),[{id:id,text:message}]);});}else{setPoliteMessages(function(messages){return[].concat(_toConsumableArray(messages),[{id:id,text:message}]);});}if(message!==''){setTimeout(function(){if(assertiveness==='assertive'){setAssertiveMessages(function(messages){return messages.filter(function(message){return message.id!==id;});});}else{setPoliteMessages(function(messages){return messages.filter(function(message){return message.id!==id;});});}},timeout);}};useImperativeHandle(ref,function(){return{announce:announce,clear:clear};});return _react.createElement(Fragment,null,_react.createElement($de8b453f082d29ae3c4c121e2b261$var$MessageBlock,{\"aria-live\":\"assertive\"},assertiveMessages.map(function(message){return _react.createElement(\"div\",{key:message.id},message.text);})),_react.createElement($de8b453f082d29ae3c4c121e2b261$var$MessageBlock,{\"aria-live\":\"polite\"},politeMessages.map(function(message){return _react.createElement(\"div\",{key:message.id},message.text);})));});function $de8b453f082d29ae3c4c121e2b261$var$MessageBlock(_ref){var children=_ref.children,ariaLive=_ref['aria-live'];return _react.createElement(VisuallyHidden,{role:\"log\",\"aria-live\":ariaLive,\"aria-relevant\":\"additions\"},children);}","map":{"version":3,"sources":["packages/@react-aria/live-announcer/src/LiveAnnouncer.tsx"],"names":["LIVEREGION_TIMEOUT_DELAY","liveRegionAnnouncer","React","node","messageId","assertiveness","timeout","ensureInstance","announcer","ReactDOM","document","callback","LiveRegionAnnouncer","useState","clear","setAssertiveMessages","setPoliteMessages","announce","id","messages","text","message","setTimeout","useImperativeHandle","assertiveMessages","politeMessages","ariaLive"],"mappings":"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","sourcesContent":["/*\n * Copyright 2020 Adobe. All rights reserved.\n * This file is licensed to you under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License. You may obtain a copy\n * of the License at http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\n * OF ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n */\n\nimport React, {Fragment, ReactNode, RefObject, useImperativeHandle, useState} from 'react';\nimport ReactDOM from 'react-dom';\nimport {VisuallyHidden} from '@react-aria/visually-hidden';\n\ntype Assertiveness = 'assertive' | 'polite';\ninterface Announcer {\n  announce(message: string, assertiveness: Assertiveness, timeout: number): void,\n  clear(assertiveness: Assertiveness): void\n}\n\n/* Inspired by https://github.com/AlmeroSteyn/react-aria-live */\nconst LIVEREGION_TIMEOUT_DELAY = 7000;\n\nlet liveRegionAnnouncer = React.createRef<Announcer>();\nlet node: HTMLElement = null;\nlet messageId = 0;\n\n/**\n * Announces the message using screen reader technology.\n */\nexport function announce(\n  message: string,\n  assertiveness: Assertiveness = 'assertive',\n  timeout = LIVEREGION_TIMEOUT_DELAY\n) {\n  ensureInstance(announcer => announcer.announce(message, assertiveness, timeout));\n}\n\n/**\n * Stops all queued announcements.\n */\nexport function clearAnnouncer(assertiveness: Assertiveness) {\n  ensureInstance(announcer => announcer.clear(assertiveness));\n}\n\n/**\n * Removes the announcer from the DOM.\n */\nexport function destroyAnnouncer() {\n  if (liveRegionAnnouncer.current) {\n    ReactDOM.unmountComponentAtNode(node);\n    document.body.removeChild(node);\n    node = null;\n  }\n}\n\n/**\n * Ensures we only have one instance of the announcer so that we don't have elements competing.\n */\nfunction ensureInstance(callback: (announcer: Announcer) => void) {\n  if (!liveRegionAnnouncer.current) {\n    node = document.createElement('div');\n    node.dataset.liveAnnouncer = 'true';\n    document.body.prepend(node);\n    ReactDOM.render(\n      <LiveRegionAnnouncer ref={liveRegionAnnouncer} />,\n      node,\n      () => callback(liveRegionAnnouncer.current)\n    );\n  } else {\n    callback(liveRegionAnnouncer.current);\n  }\n}\n\nconst LiveRegionAnnouncer = React.forwardRef((_, ref: RefObject<Announcer>) => {\n  let [assertiveMessages, setAssertiveMessages] = useState([]);\n  let [politeMessages, setPoliteMessages] = useState([]);\n\n  let clear = (assertiveness: Assertiveness) => {\n    if (!assertiveness || assertiveness === 'assertive') {\n      setAssertiveMessages([]);\n    }\n\n    if (!assertiveness || assertiveness === 'polite') {\n      setPoliteMessages([]);\n    }\n  };\n\n  let announce = (message: string, assertiveness = 'assertive', timeout = LIVEREGION_TIMEOUT_DELAY) => {\n    let id = messageId++;\n\n    if (assertiveness === 'assertive') {\n      setAssertiveMessages(messages => [...messages, {id, text: message}]);\n    } else {\n      setPoliteMessages(messages => [...messages, {id, text: message}]);\n    }\n\n    if (message !== '') {\n      setTimeout(() => {\n        if (assertiveness === 'assertive') {\n          setAssertiveMessages(messages => messages.filter(message => message.id !== id));\n        } else {\n          setPoliteMessages(messages => messages.filter(message => message.id !== id));\n        }\n      }, timeout);\n    }\n  };\n\n  useImperativeHandle(ref, () => ({\n    announce,\n    clear\n  }));\n\n  return (\n    <Fragment>\n      <MessageBlock aria-live=\"assertive\">\n        {assertiveMessages.map(message => <div key={message.id}>{message.text}</div>)}\n      </MessageBlock>\n      <MessageBlock aria-live=\"polite\">\n        {politeMessages.map(message => <div key={message.id}>{message.text}</div>)}\n      </MessageBlock>\n    </Fragment>\n  );\n});\n\ninterface MessageBlockProps {\n   children: ReactNode,\n   'aria-live': Assertiveness\n }\n\nfunction MessageBlock({children, 'aria-live': ariaLive}: MessageBlockProps) {\n  return (\n    <VisuallyHidden\n      role=\"log\"\n      aria-live={ariaLive}\n      aria-relevant=\"additions\">\n      {children}\n    </VisuallyHidden>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}
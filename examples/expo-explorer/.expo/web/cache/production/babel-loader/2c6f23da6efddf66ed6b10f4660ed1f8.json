{"ast":null,"code":"import _toConsumableArray from\"@babel/runtime/helpers/toConsumableArray\";import{disableTextSelection,restoreTextSelection}from\"./textSelection\";import{useMemo,useRef}from'react';import{useGlobalListeners}from'@react-aria/utils';export function useMove(props){var onMoveStart=props.onMoveStart,onMove=props.onMove,onMoveEnd=props.onMoveEnd;var state=useRef({didMove:false,lastPosition:null,id:null});var _useGlobalListeners=useGlobalListeners(),addGlobalListener=_useGlobalListeners.addGlobalListener,removeGlobalListener=_useGlobalListeners.removeGlobalListener;var moveProps=useMemo(function(){var moveProps={};var start=function start(){disableTextSelection();state.current.didMove=false;};var move=function move(pointerType,deltaX,deltaY){if(deltaX===0&&deltaY===0){return;}if(!state.current.didMove){state.current.didMove=true;onMoveStart===null||onMoveStart===void 0?void 0:onMoveStart({type:'movestart',pointerType:pointerType});}onMove({type:'move',pointerType:pointerType,deltaX:deltaX,deltaY:deltaY});};var end=function end(pointerType){restoreTextSelection();if(state.current.didMove){onMoveEnd===null||onMoveEnd===void 0?void 0:onMoveEnd({type:'moveend',pointerType:pointerType});}};if(typeof PointerEvent!=='undefined'){var onMouseMove=function onMouseMove(e){if(e.button===0){move('mouse',e.pageX-state.current.lastPosition.pageX,e.pageY-state.current.lastPosition.pageY);state.current.lastPosition={pageX:e.pageX,pageY:e.pageY};}};var onMouseUp=function onMouseUp(e){if(e.button===0){end('mouse');removeGlobalListener(window,'mousemove',onMouseMove,false);removeGlobalListener(window,'mouseup',onMouseUp,false);}};moveProps.onMouseDown=function(e){if(e.button===0){start();e.stopPropagation();e.preventDefault();state.current.lastPosition={pageX:e.pageX,pageY:e.pageY};addGlobalListener(window,'mousemove',onMouseMove,false);addGlobalListener(window,'mouseup',onMouseUp,false);}};var onTouchMove=function onTouchMove(e){var touch=_toConsumableArray(e.changedTouches).findIndex(function(_ref){var identifier=_ref.identifier;return identifier===state.current.id;});if(touch>=0){var _e$changedTouches$tou=e.changedTouches[touch],pageX=_e$changedTouches$tou.pageX,pageY=_e$changedTouches$tou.pageY;move('touch',pageX-state.current.lastPosition.pageX,pageY-state.current.lastPosition.pageY);state.current.lastPosition={pageX:pageX,pageY:pageY};}};var onTouchEnd=function onTouchEnd(e){var touch=_toConsumableArray(e.changedTouches).findIndex(function(_ref2){var identifier=_ref2.identifier;return identifier===state.current.id;});if(touch>=0){end('touch');state.current.id=null;removeGlobalListener(window,'touchmove',onTouchMove);removeGlobalListener(window,'touchend',onTouchEnd);removeGlobalListener(window,'touchcancel',onTouchEnd);}};moveProps.onTouchStart=function(e){if(e.changedTouches.length===0||state.current.id!=null){return;}var _e$changedTouches$=e.changedTouches[0],pageX=_e$changedTouches$.pageX,pageY=_e$changedTouches$.pageY,identifier=_e$changedTouches$.identifier;start();e.stopPropagation();e.preventDefault();state.current.lastPosition={pageX:pageX,pageY:pageY};state.current.id=identifier;addGlobalListener(window,'touchmove',onTouchMove,false);addGlobalListener(window,'touchend',onTouchEnd,false);addGlobalListener(window,'touchcancel',onTouchEnd,false);};}var triggerKeyboardMove=function triggerKeyboardMove(deltaX,deltaY){start();move('keyboard',deltaX,deltaY);end('keyboard');};moveProps.onKeyDown=function(e){switch(e.key){case'Left':case'ArrowLeft':e.preventDefault();e.stopPropagation();triggerKeyboardMove(-1,0);break;case'Right':case'ArrowRight':e.preventDefault();e.stopPropagation();triggerKeyboardMove(1,0);break;case'Up':case'ArrowUp':e.preventDefault();e.stopPropagation();triggerKeyboardMove(0,-1);break;case'Down':case'ArrowDown':e.preventDefault();e.stopPropagation();triggerKeyboardMove(0,1);break;}};return moveProps;},[state,onMoveStart,onMove,onMoveEnd,addGlobalListener,removeGlobalListener]);return{moveProps:moveProps};}","map":{"version":3,"sources":["useMove.web.ts"],"names":["onMoveEnd","state","useRef","didMove","lastPosition","id","removeGlobalListener","useGlobalListeners","moveProps","useMemo","start","disableTextSelection","move","deltaX","deltaY","onMoveStart","type","pointerType","onMove","end","restoreTextSelection","onMouseMove","e","pageX","pageY","onMouseUp","addGlobalListener","onTouchMove","touch","identifier","onTouchEnd","triggerKeyboardMove"],"mappings":"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","sourcesContent":["/*\n * Copyright 2020 Adobe. All rights reserved.\n * This file is licensed to you under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License. You may obtain a copy\n * of the License at http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\n * OF ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n */\n\nimport { disableTextSelection, restoreTextSelection } from './textSelection';\nimport { MoveEvents, PointerType } from '@react-types/shared';\nimport React, { HTMLAttributes, useMemo, useRef } from 'react';\nimport { useGlobalListeners } from '@react-aria/utils';\n\ninterface MoveResult {\n  /** Props to spread on the target element. */\n  moveProps: HTMLAttributes<HTMLElement>;\n}\n\n/**\n * Handles move interactions across mouse, touch, and keyboard, including dragging with\n * the mouse or touch, and using the arrow keys. Normalizes behavior across browsers and\n * platforms, and ignores emulated mouse events on touch devices.\n */\nexport function useMove(props: MoveEvents): MoveResult {\n  let { onMoveStart, onMove, onMoveEnd } = props;\n\n  let state = useRef<{\n    didMove: boolean;\n    lastPosition: { pageX: number; pageY: number } | null;\n    id: number | null;\n  }>({ didMove: false, lastPosition: null, id: null });\n\n  let { addGlobalListener, removeGlobalListener } = useGlobalListeners();\n\n  let moveProps = useMemo(() => {\n    let moveProps: HTMLAttributes<HTMLElement> = {};\n\n    let start = () => {\n      disableTextSelection();\n      state.current.didMove = false;\n    };\n    let move = (pointerType: PointerType, deltaX: number, deltaY: number) => {\n      if (deltaX === 0 && deltaY === 0) {\n        return;\n      }\n\n      if (!state.current.didMove) {\n        state.current.didMove = true;\n        onMoveStart?.({\n          type: 'movestart',\n          pointerType,\n        });\n      }\n      onMove({\n        type: 'move',\n        pointerType,\n        deltaX: deltaX,\n        deltaY: deltaY,\n      });\n    };\n    let end = (pointerType: PointerType) => {\n      restoreTextSelection();\n      if (state.current.didMove) {\n        onMoveEnd?.({\n          type: 'moveend',\n          pointerType,\n        });\n      }\n    };\n\n    if (typeof PointerEvent !== 'undefined') {\n      let onMouseMove = (e: MouseEvent) => {\n        if (e.button === 0) {\n          move(\n            'mouse',\n            e.pageX - state.current.lastPosition.pageX,\n            e.pageY - state.current.lastPosition.pageY\n          );\n          state.current.lastPosition = { pageX: e.pageX, pageY: e.pageY };\n        }\n      };\n      let onMouseUp = (e: MouseEvent) => {\n        if (e.button === 0) {\n          end('mouse');\n          removeGlobalListener(window, 'mousemove', onMouseMove, false);\n          removeGlobalListener(window, 'mouseup', onMouseUp, false);\n        }\n      };\n      moveProps.onMouseDown = (e: React.MouseEvent) => {\n        if (e.button === 0) {\n          start();\n          e.stopPropagation();\n          e.preventDefault();\n          state.current.lastPosition = { pageX: e.pageX, pageY: e.pageY };\n          addGlobalListener(window, 'mousemove', onMouseMove, false);\n          addGlobalListener(window, 'mouseup', onMouseUp, false);\n        }\n      };\n\n      let onTouchMove = (e: TouchEvent) => {\n        // @ts-ignore\n        let touch = [...e.changedTouches].findIndex(\n          ({ identifier }) => identifier === state.current.id\n        );\n        if (touch >= 0) {\n          let { pageX, pageY } = e.changedTouches[touch];\n          move(\n            'touch',\n            pageX - state.current.lastPosition.pageX,\n            pageY - state.current.lastPosition.pageY\n          );\n          state.current.lastPosition = { pageX, pageY };\n        }\n      };\n      let onTouchEnd = (e: TouchEvent) => {\n        // @ts-ignore\n        let touch = [...e.changedTouches].findIndex(\n          ({ identifier }) => identifier === state.current.id\n        );\n        if (touch >= 0) {\n          end('touch');\n          state.current.id = null;\n          removeGlobalListener(window, 'touchmove', onTouchMove);\n          removeGlobalListener(window, 'touchend', onTouchEnd);\n          removeGlobalListener(window, 'touchcancel', onTouchEnd);\n        }\n      };\n      moveProps.onTouchStart = (e: React.TouchEvent) => {\n        if (e.changedTouches.length === 0 || state.current.id != null) {\n          return;\n        }\n\n        let { pageX, pageY, identifier } = e.changedTouches[0];\n        start();\n        e.stopPropagation();\n        e.preventDefault();\n        state.current.lastPosition = { pageX, pageY };\n        state.current.id = identifier;\n        addGlobalListener(window, 'touchmove', onTouchMove, false);\n        addGlobalListener(window, 'touchend', onTouchEnd, false);\n        addGlobalListener(window, 'touchcancel', onTouchEnd, false);\n      };\n    }\n\n    let triggerKeyboardMove = (deltaX: number, deltaY: number) => {\n      start();\n      move('keyboard', deltaX, deltaY);\n      end('keyboard');\n    };\n\n    moveProps.onKeyDown = (e) => {\n      switch (e.key) {\n        case 'Left':\n        case 'ArrowLeft':\n          e.preventDefault();\n          e.stopPropagation();\n          triggerKeyboardMove(-1, 0);\n          break;\n        case 'Right':\n        case 'ArrowRight':\n          e.preventDefault();\n          e.stopPropagation();\n          triggerKeyboardMove(1, 0);\n          break;\n        case 'Up':\n        case 'ArrowUp':\n          e.preventDefault();\n          e.stopPropagation();\n          triggerKeyboardMove(0, -1);\n          break;\n        case 'Down':\n        case 'ArrowDown':\n          e.preventDefault();\n          e.stopPropagation();\n          triggerKeyboardMove(0, 1);\n          break;\n      }\n    };\n\n    return moveProps;\n  }, [\n    state,\n    onMoveStart,\n    onMove,\n    onMoveEnd,\n    addGlobalListener,\n    removeGlobalListener,\n  ]);\n\n  return { moveProps };\n}\n"]},"metadata":{},"sourceType":"module"}